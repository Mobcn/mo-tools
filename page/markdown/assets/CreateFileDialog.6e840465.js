import K from"./MoDialog.ed7cb9b3.js";import I from"./MoInput.299a7ded.js";import{_ as z}from"./_plugin-vue_export-helper.cdc0426e.js";const o=(l=>{class v{constructor(e){this.fileHandle=e}verifyPermission(e=!1){return H(this.fileHandle,e)}write(e,t=!0){return j(this.fileHandle,e,t)}readFileHandleAsText(){return S(this.fileHandle)}readFileHandleAsDataURL(){return E(this.fileHandle)}readFileHandleAsBinaryString(){return k(this.fileHandle)}readFileHandleAsArrayBuffer(){return C(this.fileHandle)}readFileHandle(e="Text"){return g(this.fileHandle,e)}getFileHandle(){return this.fileHandle}}class p{constructor(e){this.dirHandle=e}getFileHandle(e){return h(this.dirHandle,e)}getDirectoryHandle(e){return F(this.dirHandle,e)}getFileHandleArray(){return d(this.dirHandle)}getDirectoryHandleArray(){return c(this.dirHandle)}getHandleArray(e="all"){return u(this.dirHandle,e)}getHandleMap(e="/"){return D(this.dirHandle,e)}createFile(e){return P(this.dirHandle,e)}createDirectory(e){return b(this.dirHandle,e)}removeFile(e){return _(this.dirHandle,e)}removeDirectory(e){return O(this.dirHandle,e)}resolve(e){return V(this.dirHandle,e)}getChildHandlePath(e){return B(this.dirHandle,e)}getDirectoryHandle(){return this.dirHandle}}const s={text:{"text/plain":[".txt",".md"]},image:{"image/png":".png","image/jpeg":[".jpe",".jpg",".jpeg"],"image/gif":".gif"}};function m(r){if(r instanceof FileSystemFileHandle)return new v(r);throw new Error("\u83B7\u53D6\u6587\u4EF6\u53E5\u67C4Buffer\u5931\u8D25\uFF0C\u53C2\u6570\u4E0D\u4E3A\u6587\u4EF6\u53E5\u67C4\uFF01")}function f(r){if(r instanceof FileSystemDirectoryHandle)return new p(r);throw new Error("\u83B7\u53D6\u76EE\u5F55\u53E5\u67C4Buffer\u5931\u8D25\uFF0C\u53C2\u6570\u4E0D\u4E3A\u76EE\u5F55\u53E5\u67C4\uFF01")}async function y(r="\u6587\u672C\u6587\u4EF6",e="text",t=!1){try{let a;if(typeof e=="string"){if(a=s[e.toLowerCase()],a===void 0)throw Error(`\u6587\u4EF6\u7C7B\u578B${e}\u4E0D\u5B58\u5728\uFF01`)}else if(e instanceof Array){const i=[];for(const N of e){const M=s[N.toLowerCase()];if(M===void 0)throw Error(`\u6587\u4EF6\u7C7B\u578B${N}\u4E0D\u5B58\u5728\uFF01`);i.push(M)}a=Object.assign({},...i)}else throw new Error("\u6587\u4EF6\u7C7B\u578B\u53C2\u6570\u9519\u8BEF\uFF01");const n=await showOpenFilePicker({multiple:t,types:[{description:r,accept:a}],excludeAcceptAllOption:!0});return t?n:n[0]}catch(a){return a.message.indexOf("The user aborted a request")===-1&&console.error(a),null}}async function A(){try{return await showDirectoryPicker()}catch(r){return r.message.indexOf("The user aborted a request")===-1&&console.error(r),null}}async function H(r,e=!1){const t={writable:e,mode:e?"readwrite":"read"};return await r.queryPermission(t)==="granted"||await r.requestPermission(t)==="granted"}async function h(r,e){const t=e.split("/"),a=t[t.length-1];if(a.trim()==="")throw Error("\u6587\u4EF6\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\uFF01");let n=r;try{for(let i=0;i<t.length-1;++i)n=await n.getDirectoryHandle(t[i]);return await n.getFileHandle(a)}catch(i){return console.error(i),null}}async function F(r,e){const t=e.split("/"),a=t[t.length-1];if(a.trim()==="")throw Error("\u76EE\u5F55\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\uFF01");let n=r;try{for(let i=0;i<t.length-1;++i)n=await n.getDirectoryHandle(t[i]);return await n.getDirectoryHandle(a)}catch(i){return console.error(i),null}}async function d(r){return await u(r,"file")}async function c(r){return await u(r,"directory")}async function u(r,e="all"){const t=[];for await(const a of r.values())(a.kind===e||e=="all")&&t.push(a);return t}async function D(r,e="/"){const t=new Map;for await(const a of r.values()){const n=new Map;if(n.set("handle",a),a.kind==="directory"){const i=e+a.name+"/";n.set("children",await D(a,i)),t.set(i,n)}else t.set(e+a.name,n)}return t}async function P(r,e){const t=e.split("/"),a=t[t.length-1];if(a.trim()==="")throw Error("\u6587\u4EF6\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\uFF01");let n=r;try{for(let i=0;i<t.length-1;++i)n=await n.getDirectoryHandle(t[i],{create:!0});throw await n.getFileHandle(a),Error("\u6587\u4EF6\u540D\u79F0\u4E3A'"+a+"'\u7684\u6587\u4EF6\u5DF2\u5B58\u5728\uFF01")}catch(i){return i.message.indexOf("\u6587\u4EF6\u5DF2\u5B58\u5728")===-1?await n.getFileHandle(a,{create:!0}):(console.error(i),null)}}async function b(r,e){const t=e.split("/"),a=t[t.length-1];if(a.trim()==="")throw Error("\u76EE\u5F55\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\uFF01");let n=r;try{for(let i=0;i<t.length-1;++i)n=await n.getDirectoryHandle(t[i],{create:!0});throw await n.getDirectoryHandle(a),Error("\u76EE\u5F55\u540D\u79F0\u4E3A'"+a+"'\u7684\u76EE\u5F55\u5DF2\u5B58\u5728\uFF01")}catch(i){return i.message.indexOf("\u76EE\u5F55\u5DF2\u5B58\u5728")===-1?await n.getDirectoryHandle(a,{create:!0}):(console.error(i),null)}}async function _(r,e){const t=e.split("/"),a=t[t.length-1];let n=r;try{for(let i=0;i<t.length-1;++i)n=await n.getDirectoryHandle(t[i]);await n.getFileHandle(a),await n.removeEntry(a)}catch{}return!0}async function O(r,e){const t=e.split("/"),a=t[t.length-1];let n=r;try{for(let i=0;i<t.length-1;++i)n=await n.getDirectoryHandle(t[i]);await n.getDirectoryHandle(a),await n.removeEntry(a,{recursive:!0})}catch{}return!0}async function j(r,e,t=!0){if(!await H(r,!0))return alert("\u6587\u4EF6\u6CA1\u6709\u5199\u5165\u6743\u9650\uFF01"),!1;const a=await r.createWritable({keepExistingData:t});if(t){const n=await r.getFile();a.seek(n.size)}return a.write(e),a.close(),!0}async function R(r,e){return await r.isSameEntry(e)}async function V(r,e){return await r.resolve(e)}async function B(r,e){const t=await r.resolve(e);return t===null?null:`{${r.name}}/`+t.join("/")+(e.kind==="directory"?"/":"")}async function T(r){return await w(r)}async function U(r){return await w(r,"DataURL")}async function $(r){return await w(r,"BinaryString")}async function q(r){return await w(r,"ArrayBuffer")}async function S(r){return await g(r)}async function E(r){return await g(r,"DataURL")}async function k(r){return await g(r,"BinaryString")}async function C(r){return await g(r,"ArrayBuffer")}async function g(r,e="Text"){return new Promise(async function(t,a){try{const n=await r.getFile(),i=new FileReader;i.onload=()=>{t(i.result)},i.onerror=()=>{a(i.error)},i["readAs"+e](n)}catch(n){a(n)}})}async function w(r,e="Text"){return new Promise(function(t,a){const n=new FileReader;n.onload=()=>{t(n.result)},n.onerror=()=>{a(n.error)},n["readAs"+e](r)})}return Object.defineProperty(l,"getFileHandleBuffer",{value:m}),Object.defineProperty(l,"getDirectoryHandleBuffer",{value:f}),Object.defineProperty(l,"openFilePicker",{value:y}),Object.defineProperty(l,"openDirectoryPicker",{value:A}),Object.defineProperty(l,"verifyPermission",{value:H}),Object.defineProperty(l,"getFileHandle",{value:h}),Object.defineProperty(l,"getDirectoryHandle",{value:F}),Object.defineProperty(l,"getFileHandleArray",{value:d}),Object.defineProperty(l,"getDirectoryHandleArray",{value:c}),Object.defineProperty(l,"getHandleArray",{value:u}),Object.defineProperty(l,"getHandleMap",{value:D}),Object.defineProperty(l,"createFile",{value:P}),Object.defineProperty(l,"createDirectory",{value:b}),Object.defineProperty(l,"removeFile",{value:_}),Object.defineProperty(l,"removeDirectory",{value:O}),Object.defineProperty(l,"write",{value:j}),Object.defineProperty(l,"isSameEntry",{value:R}),Object.defineProperty(l,"resolve",{value:V}),Object.defineProperty(l,"getChildHandlePath",{value:B}),Object.defineProperty(l,"readFileAsText",{value:T}),Object.defineProperty(l,"readFileAsDataURL",{value:U}),Object.defineProperty(l,"readFileAsBinaryString",{value:$}),Object.defineProperty(l,"readFileAsArrayBuffer",{value:q}),Object.defineProperty(l,"readFileHandleAsText",{value:S}),Object.defineProperty(l,"readFileHandleAsDataURL",{value:E}),Object.defineProperty(l,"readFileHandleAsBinaryString",{value:k}),Object.defineProperty(l,"readFileHandleAsArrayBuffer",{value:C}),Object.defineProperty(l,"readFileHandle",{value:g}),Object.defineProperty(l,"readFile",{value:w}),Object.defineProperty(l,"__esModule",{value:!0}),l})({});o.getFileHandleBuffer;o.getDirectoryHandleBuffer;const ne=o.openFilePicker,W=o.openDirectoryPicker;o.verifyPermission;o.getFileHandle;o.getDirectoryHandle;o.getFileHandleArray;o.getDirectoryHandleArray;o.getHandleArray;o.getHandleMap;const G=o.createFile;o.createDirectory;o.removeFile;o.removeDirectory;const ie=o.write;o.isSameEntry;o.resolve;o.getChildHandlePath;o.readFileAsText;o.readFileAsDataURL;o.readFileAsBinaryString;o.readFileAsArrayBuffer;o.readFileHandleAsText;o.readFileHandleAsDataURL;o.readFileHandleAsBinaryString;o.readFileHandleAsArrayBuffer;const le=o.readFileHandle;o.readFile;const L=l=>(Vue.pushScopeId("data-v-fe10f2a3"),l=l(),Vue.popScopeId(),l),J={class:"create-file-dialog"},Q={class:"create-file-dialog__item"},X=L(()=>Vue.createElementVNode("label",{class:"create-file-dialog__label"},"\u76EE\u5F55",-1)),Y={class:"create-file-dialog__item"},Z=L(()=>Vue.createElementVNode("label",{class:"create-file-dialog__label"},"\u6587\u4EF6\u540D",-1)),x={__name:"CreateFileDialog",emits:["comfirm"],setup(l,{expose:v,emit:p}){const s=Vue.ref(!1),m=Vue.ref(null),f=Vue.ref(""),y=Vue.ref(""),A=()=>{F(),s.value=!0},H=async()=>{const d=await W();d&&(m.value=d,f.value=d.name)},h=async()=>{if(f.value==="")alert("\u8BF7\u9009\u62E9\u76EE\u5F55\uFF01");else if(y.value.trim()==="")alert("\u8BF7\u8F93\u5165\u6587\u4EF6\u540D\uFF01");else{let d=y.value.trim();d.endsWith(".md")||(d+=".md");const c=await G(m.value,d);c?p("comfirm",c,s):alert("\u521B\u5EFA\u6587\u4EF6\u5931\u8D25\uFF01")}},F=()=>{f.value="",y.value="",m.value=null};return v({init:A}),(d,c)=>(Vue.openBlock(),Vue.createElementBlock("div",J,[s.value?(Vue.openBlock(),Vue.createBlock(K,{key:0,title:"\u65B0\u5EFA\u6587\u4EF6",width:"350px",onCancel:c[2]||(c[2]=u=>s.value=!1),onComfirm:h},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",Q,[X,Vue.createVNode(I,{modelValue:f.value,"onUpdate:modelValue":c[0]||(c[0]=u=>f.value=u),readonly:!0,onClick:H},null,8,["modelValue"])]),Vue.createElementVNode("div",Y,[Z,Vue.createVNode(I,{modelValue:y.value,"onUpdate:modelValue":c[1]||(c[1]=u=>y.value=u),onKeyup:Vue.withKeys(h,["enter","native"])},null,8,["modelValue","onKeyup"])])]),_:1})):Vue.createCommentVNode("",!0)]))}},ee=z(x,[["__scopeId","data-v-fe10f2a3"]]),oe=Object.freeze(Object.defineProperty({__proto__:null,default:ee},Symbol.toStringTag,{value:"Module"}));export{ee as C,oe as a,ne as o,le as r,ie as w};
